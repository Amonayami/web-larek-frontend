(()=>{"use strict";var e="".concat("","/api/weblarek"),t="".concat("","/content/weblarek");function isSelector(e){return"string"==typeof e&&e.length>1}function ensureElement(e,t){if(isSelector(e)){var r=function ensureAllElements(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(isSelector(e))return Array.from(t.querySelectorAll(e));if(e instanceof NodeList)return Array.from(e);if(Array.isArray(e))return e;throw new Error("Unknown selector element")}(e,t);if(r.length>1&&console.warn("selector ".concat(e," return more then one element")),0===r.length)throw new Error("selector ".concat(e," return nothing"));return r.pop()}if(e instanceof HTMLElement)return e;throw new Error("Unknown selector element")}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===_typeof(i)?i:String(i)),n)}var o,i}var r=function(){function Api(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Api),this.baseUrl=e,this.options={headers:Object.assign({"Content-Type":"application/json"},null!==(t=r.headers)&&void 0!==t?t:{})}}return function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(Api,[{key:"handleResponse",value:function handleResponse(e){return e.ok?e.json():e.json().then((function(t){var r;return Promise.reject(null!==(r=t.error)&&void 0!==r?r:e.statusText)}))}},{key:"get",value:function get(e){return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:"GET"})).then(this.handleResponse)}},{key:"post",value:function post(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return fetch(this.baseUrl+e,Object.assign(Object.assign({},this.options),{method:r,body:JSON.stringify(t)})).then(this.handleResponse)}}]),Api}();function events_typeof(e){return events_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},events_typeof(e)}function events_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function events_toPrimitive(e,t){if("object"!==events_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==events_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===events_typeof(i)?i:String(i)),n)}var o,i}var n=function(){function EventEmitter(){!function events_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventEmitter),this._events=new Map}return function events_createClass(e,t,r){return t&&events_defineProperties(e.prototype,t),r&&events_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(EventEmitter,[{key:"on",value:function on(e,t){var r;this._events.has(e)||this._events.set(e,new Set),null===(r=this._events.get(e))||void 0===r||r.add(t)}},{key:"off",value:function off(e,t){var r;this._events.has(e)&&(this._events.get(e).delete(t),0===(null===(r=this._events.get(e))||void 0===r?void 0:r.size)&&this._events.delete(e))}},{key:"emit",value:function emit(e,t){this._events.forEach((function(r,n){"*"===n&&r.forEach((function(r){return r({eventName:e,data:t})})),(n instanceof RegExp&&n.test(e)||n===e)&&r.forEach((function(e){return e(t)}))}))}},{key:"onAll",value:function onAll(e){this.on("*",e)}},{key:"offAll",value:function offAll(){this._events=new Map}},{key:"trigger",value:function trigger(e,t){var r=this;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.emit(e,Object.assign(Object.assign({},n||{}),t||{}))}}}]),EventEmitter}();function CardsModel_typeof(e){return CardsModel_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CardsModel_typeof(e)}function CardsModel_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function CardsModel_toPrimitive(e,t){if("object"!==CardsModel_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==CardsModel_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===CardsModel_typeof(i)?i:String(i)),n)}var o,i}var o=function(){function CardsModel(e){!function CardsModel_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CardsModel),this.events=e,this._cards=[],this._preview=null}return function CardsModel_createClass(e,t,r){return t&&CardsModel_defineProperties(e.prototype,t),r&&CardsModel_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(CardsModel,[{key:"cards",get:function get(){return this._cards},set:function set(e){this._cards=e,this.events.emit("items:change",this._cards)}},{key:"preview",get:function get(){return this._preview},set:function set(e){this._preview=e,this.events.emit("preview:changed",this.getCard(e))}},{key:"getCard",value:function getCard(e){return this._cards.find((function(t){return t.id===e}))}},{key:"hasSelected",value:function hasSelected(){return null!==this._preview}}]),CardsModel}();function CartModel_typeof(e){return CartModel_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CartModel_typeof(e)}function CartModel_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function CartModel_toPrimitive(e,t){if("object"!==CartModel_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==CartModel_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===CartModel_typeof(i)?i:String(i)),n)}var o,i}var i=function(){function CartModel(e){!function CartModel_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CartModel),this.events=e,this.items=[]}return function CartModel_createClass(e,t,r){return t&&CartModel_defineProperties(e.prototype,t),r&&CartModel_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(CartModel,[{key:"getItems",value:function getItems(){return this.items}},{key:"addItem",value:function addItem(e){this.items.find((function(t){return t.id===e.id}))||(this.items.push(e),this.events.emit("cart:changed",this.items))}},{key:"deleteItem",value:function deleteItem(e){this.items=this.items.filter((function(t){return t.id!==e})),this.events.emit("cart:changed",this.items)}},{key:"getTotalPrice",value:function getTotalPrice(){return this.items.reduce((function(e,t){return e+t.price}),0)}},{key:"hasItems",value:function hasItems(){return this.items.length>0}},{key:"clear",value:function clear(){this.items=[],this.events.emit("cart:changed",this.items)}}]),CartModel}();function OrderModel_typeof(e){return OrderModel_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},OrderModel_typeof(e)}function OrderModel_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function OrderModel_toPrimitive(e,t){if("object"!==OrderModel_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==OrderModel_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===OrderModel_typeof(i)?i:String(i)),n)}var o,i}var a=function(){function OrderModel(e){!function OrderModel_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,OrderModel),this.events=e,this.payment="online",this.address="",this.email="",this.phone=""}return function OrderModel_createClass(e,t,r){return t&&OrderModel_defineProperties(e.prototype,t),r&&OrderModel_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(OrderModel,[{key:"setPayment",value:function setPayment(e){this.payment=e,this.events.emit("order:changed",this)}},{key:"setAddress",value:function setAddress(e){this.address=e,this.events.emit("order:changed",this)}},{key:"setContactInfo",value:function setContactInfo(e,t){this.email=e,this.phone=t,this.events.emit("order:changed",this)}},{key:"isValid",value:function isValid(){return Boolean(this.payment&&this.address&&this.email&&this.phone)}},{key:"clear",value:function clear(){this.payment="online",this.address="",this.email="",this.phone="",this.events.emit("order:cleared")}},{key:"getOrderData",value:function getOrderData(){return{payment:this.payment,address:this.address,email:this.email,phone:this.phone}}}]),OrderModel}();function CardView_typeof(e){return CardView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CardView_typeof(e)}function CardView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function CardView_toPrimitive(e,t){if("object"!==CardView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==CardView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===CardView_typeof(i)?i:String(i)),n)}var o,i}var l=function(){function CardView(e,t){!function CardView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CardView),this.emitter=t,this.categoryColors={"софт-скил":"soft",другое:"other",кнопка:"button","хард-скил":"hard",дополнительное:"additional"},this.template=e}return function CardView_createClass(e,t,r){return t&&CardView_defineProperties(e.prototype,t),r&&CardView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(CardView,[{key:"setText",value:function setText(e,t){e&&(e.textContent=String(t))}},{key:"setCategory",value:function setCategory(e,t){var r;this.setText(e,t);var n=t.toLowerCase().trim(),o=null!==(r=this.categoryColors[n])&&void 0!==r?r:"other";e.className="card__category card__category_".concat(o)}},{key:"render",value:function render(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.template.content.firstElementChild.cloneNode(!0),i=o.querySelector(".card__title");i&&this.setText(i,e.title);var a=o.querySelector(".card__price");if(a){var l="number"!=typeof e.price;a.textContent=l?"Бесценно":"".concat(e.price," синапсов")}var s=o.querySelector(".card__image");s&&"image"in e&&(s.src=e.image.startsWith("http")?e.image:"".concat(t.replace(/\/$/,"")).concat(e.image),s.alt=e.title);var c=o.querySelector(".card__category");c&&"category"in e&&this.setCategory(c,e.category);var u=o.querySelector(".card__text");if(u&&"description"in e&&this.setText(u,e.description),n.addable){var f=o.querySelector(".card__button");if(f){var d="price"in e?e.price:void 0;"number"!=typeof d||d<=0?(f.textContent="Недоступен",f.disabled=!0,f.classList.add("card__button--disabled")):n.disabled?(f.textContent="Товар уже в корзине",f.disabled=!0,f.classList.add("card__button--disabled")):(f.textContent="В корзину",f.disabled=!1,f.classList.remove("card__button--disabled"),f.addEventListener("click",(function(t){t.stopPropagation(),"id"in e&&r.emitter.emit("basket:add",{id:e.id})})))}}if(n.removable){var y=o.querySelector(".basket__item-delete");null==y||y.addEventListener("click",(function(t){t.stopPropagation(),r.emitter.emit("card:deselect",{id:e.id})}))}return o.addEventListener("click",(function(){var t=o.querySelector(".card__button");(null==t?void 0:t.disabled)||"id"in e&&r.emitter.emit("card:select",{id:e.id})})),o}}]),CardView}();function MainView_typeof(e){return MainView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},MainView_typeof(e)}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return MainView_arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function MainView_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return MainView_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return MainView_arrayLikeToArray(e,t)}(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MainView_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MainView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function MainView_toPrimitive(e,t){if("object"!==MainView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==MainView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===MainView_typeof(i)?i:String(i)),n)}var o,i}var s=function(){function MainView(e){var t=this;!function MainView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MainView),this.emitter=e,this.container=document.querySelector(".gallery"),this.cartCounter=document.querySelector(".header__basket-counter"),this.cartIcon=document.querySelector(".header__basket"),this.cartIcon.addEventListener("click",(function(){return t.emitter.emit("basket:open")}))}return function MainView_createClass(e,t,r){return t&&MainView_defineProperties(e.prototype,t),r&&MainView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(MainView,[{key:"renderCards",value:function renderCards(e){var t;(t=this.container).replaceChildren.apply(t,_toConsumableArray(e))}},{key:"renderCartCounter",value:function renderCartCounter(e){this.cartCounter.textContent=e.toString()}}]),MainView}();function ModalView_typeof(e){return ModalView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ModalView_typeof(e)}function ModalView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function ModalView_toPrimitive(e,t){if("object"!==ModalView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ModalView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===ModalView_typeof(i)?i:String(i)),n)}var o,i}var c=function(){function ModalView(e){var t=this;!function ModalView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ModalView),this.emitter=e,this.modal=document.getElementById("modal-container"),this.content=this.modal.querySelector(".modal__content"),this.closeBtn=this.modal.querySelector(".modal__close"),this.closeBtn.addEventListener("click",(function(){return t.close()})),this.emitter.on("modal:close",(function(){return t.close()})),this.modal.addEventListener("click",(function(e){e.target===t.modal&&t.close()}))}return function ModalView_createClass(e,t,r){return t&&ModalView_defineProperties(e.prototype,t),r&&ModalView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(ModalView,[{key:"open",value:function open(e){this.render(e),this.modal.classList.add("modal_active")}},{key:"close",value:function close(){this.modal.classList.remove("modal_active")}},{key:"render",value:function render(e){this.content.innerHTML="",this.content.append(e)}}]),ModalView}();function CartView_typeof(e){return CartView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CartView_typeof(e)}function CartView_toConsumableArray(e){return function CartView_arrayWithoutHoles(e){if(Array.isArray(e))return CartView_arrayLikeToArray(e)}(e)||function CartView_iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function CartView_unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return CartView_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CartView_arrayLikeToArray(e,t)}(e)||function CartView_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CartView_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CartView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function CartView_toPrimitive(e,t){if("object"!==CartView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==CartView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===CartView_typeof(i)?i:String(i)),n)}var o,i}var u=function(){function CartView(e){!function CartView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CartView),this.emitter=e,this.template=document.getElementById("basket")}return function CartView_createClass(e,t,r){return t&&CartView_defineProperties(e.prototype,t),r&&CartView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(CartView,[{key:"render",value:function render(e,t){var r=this,n=this.template.content.cloneNode(!0),o=n.querySelector(".basket__list"),i=n.querySelector(".basket__price"),a=n.querySelector(".basket__button");return o.replaceChildren.apply(o,CartView_toConsumableArray(e)),i.textContent="".concat(t," синапсов"),0===e.length?a.setAttribute("disabled","true"):a.removeAttribute("disabled"),a.addEventListener("click",(function(){return r.emitter.emit("basket:submit")})),n}}]),CartView}(),f=function isNotEmpty(e){return e.trim().length>0},d=function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())},y=function isValidPhone(e){return/^\+?\d{11}$/.test(e.trim())},m=function isValidAddress(e){return f(e)},p=function isOrderValid(e,t){return m(e)&&f(t)};function showFormError(e,t){var r=e.querySelector(".form__errors");r&&(r.textContent=t)}function clearFormError(e){var t=e.querySelector(".form__errors");t&&(t.textContent="")}function OrderView_typeof(e){return OrderView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},OrderView_typeof(e)}function OrderView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function OrderView_toPrimitive(e,t){if("object"!==OrderView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==OrderView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===OrderView_typeof(i)?i:String(i)),n)}var o,i}var v=function(){function OrderView(e){!function OrderView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,OrderView),this.emitter=e,this.template=document.getElementById("order")}return function OrderView_createClass(e,t,r){return t&&OrderView_defineProperties(e.prototype,t),r&&OrderView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(OrderView,[{key:"render",value:function render(e){var t=this,r=this.template.content.cloneNode(!0),n=r.querySelector("form"),o=n.querySelector('input[name="address"]'),i=n.querySelectorAll(".order__buttons .button"),a=n.querySelector('button[type="submit"]'),l=n.querySelector(".form__errors"),s=function toggleSubmitState(){var e,t=(null==o?void 0:o.value.trim())||"",r=(null===(e=Array.from(i).find((function(e){return e.classList.contains("button_alt-active")})))||void 0===e?void 0:e.name)||"",n=p(t,r);a&&(a.disabled=!n),l&&(t||r?t&&m(t)?l.textContent=r?"":"Выберите способ оплаты":l.textContent="Введите корректный адрес":l.textContent="Введите адрес и выберите способ оплаты")};return o&&(o.value=e.address,o.addEventListener("input",(function(){t.emitter.emit("order:change",{field:"address",value:o.value}),s()}))),i.forEach((function(r){r.name&&(e.payment===r.name&&(r.classList.add("button_alt-active"),s()),r.addEventListener("click",(function(){i.forEach((function(e){return e.classList.remove("button_alt-active")})),r.classList.add("button_alt-active"),t.emitter.emit("order:change",{field:"payment",value:r.name}),s()})))})),n.addEventListener("submit",(function(e){var r;e.preventDefault();var n=(null==o?void 0:o.value.trim())||"",a=(null===(r=Array.from(i).find((function(e){return e.classList.contains("button_alt-active")})))||void 0===r?void 0:r.name)||"";p(n,a)?t.emitter.emit("order:submit"):(n&&m(n)||t.showError("address","Введите корректный адрес"),!a&&l&&(l.textContent="Выберите способ оплаты"))})),s(),r}},{key:"showError",value:function showError(e,t){showFormError(document.querySelector('form[name="order"]'),t)}},{key:"hideError",value:function hideError(e){clearFormError(document.querySelector('form[name="order"]'))}}]),OrderView}();function ContactView_typeof(e){return ContactView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ContactView_typeof(e)}function ContactView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function ContactView_toPrimitive(e,t){if("object"!==ContactView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ContactView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===ContactView_typeof(i)?i:String(i)),n)}var o,i}var b=function(){function ContactView(e){!function ContactView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ContactView),this.emitter=e,this.template=document.getElementById("contacts")}return function ContactView_createClass(e,t,r){return t&&ContactView_defineProperties(e.prototype,t),r&&ContactView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(ContactView,[{key:"render",value:function render(e){var t=this,r=this.template.content.cloneNode(!0),n=r.querySelector("form"),o=n.elements.namedItem("email"),i=n.elements.namedItem("phone"),a=n.querySelector('button[type="submit"]'),l=n.querySelector(".form__errors"),s=function toggleSubmitState(){var e=o.value.trim(),t=i.value.trim(),r=function isContactValid(e,t){return d(e)&&y(t)}(e,t);a&&(a.disabled=!r),l&&(e||t?e&&d(e)?t&&y(t)?l.textContent="":l.textContent="Некорректный телефон":l.textContent="Некорректный email":l.textContent="Введите email и телефон")};return o.value=e.email,i.value=e.phone,o.addEventListener("input",(function(){t.emitter.emit("contacts:change",{field:"email",value:o.value}),s()})),i.addEventListener("input",(function(){t.emitter.emit("contacts:change",{field:"phone",value:i.value}),s()})),n.addEventListener("submit",(function(e){e.preventDefault(),t.emitter.emit("order:success")})),s(),r}},{key:"showError",value:function showError(e,t){showFormError(document.querySelector('form[name="contacts"]'),t)}},{key:"hideError",value:function hideError(e){clearFormError(document.querySelector('form[name="contacts"]'))}}]),ContactView}();function SuccessOrderView_typeof(e){return SuccessOrderView_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SuccessOrderView_typeof(e)}function SuccessOrderView_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function SuccessOrderView_toPrimitive(e,t){if("object"!==SuccessOrderView_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==SuccessOrderView_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===SuccessOrderView_typeof(i)?i:String(i)),n)}var o,i}var h=function(){function SuccessOrderView(e){!function SuccessOrderView_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SuccessOrderView),this.emitter=e,this.template=document.getElementById("success")}return function SuccessOrderView_createClass(e,t,r){return t&&SuccessOrderView_defineProperties(e.prototype,t),r&&SuccessOrderView_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(SuccessOrderView,[{key:"render",value:function render(e){var t=this,r=this.template.content.cloneNode(!0);return r.querySelector(".order-success__description").textContent="Списано ".concat(e," синапсов"),r.querySelector(".order-success__close").addEventListener("click",(function(){return t.emitter.emit("modal:close")})),r}}]),SuccessOrderView}(),w=new n,_=new r(e),C=new o(w),g=new i(w),S=new a(w),V=new s(w),P=new c(w),k=new u(w),M=new v(w),O=new b(w),E=new h(w),j=ensureElement("#card-catalog"),T=ensureElement("#card-preview"),A=ensureElement("#card-basket"),I=new l(j,w),q=new l(T,w),L=new l(A,w);_.get("/product").then((function(e){w.emit("cards:changed",e.items)})).catch((function(e){return console.error("Ошибка загрузки карточек:",e)})),w.on("cards:changed",(function(e){C.cards=e;var t=e.map((function(e){var t=g.getItems().some((function(t){return t.id===e.id})),r="number"!=typeof e.price;return I.render(e,{addable:!r,disabled:r||t})}));V.renderCards(t)})),w.on("card:select",(function(e){var t=e.id;C.preview=t})),w.on("preview:changed",(function(e){if(e){var t=g.getItems().some((function(t){return t.id===e.id})),r="number"!=typeof e.price,n=q.render(e,{addable:!0,disabled:r||t});P.open(n)}})),w.on("basket:add",(function(e){var t=e.id,r=C.getCard(t);if(r&&"number"==typeof r.price&&(g.addItem(r),w.emit("items:change",C.cards),V.renderCartCounter(g.getItems().length)),C.preview===t){var n=q.render(r,{addable:"number"==typeof r.price,disabled:!0});P.render(n)}})),w.on("basket:open",(function(){var e=g.getItems().map((function(e,t){var r=L.render(e,{removable:!0});return r.querySelector(".basket__item-index").textContent=(t+1).toString(),r})),t=g.getTotalPrice(),r=k.render(e,t);P.open(r)})),w.on("card:deselect",(function(e){var t=e.id;if(g.deleteItem(t),w.emit("cards:changed",C.cards),V.renderCartCounter(g.getItems().length),C.preview===t){var r=C.getCard(t);if(g.hasItems()){if(r){var n="number"!=typeof r.price,o=q.render(r,{addable:!0,disabled:n||!1});P.render(o)}}else w.emit("modal:close")}var i=document.querySelector(".modal.modal_active");(null==i?void 0:i.querySelector(".basket"))&&w.emit("basket:open")})),w.on("basket:submit",(function(){var e=M.render({payment:S.payment,address:S.address});P.open(e)})),w.on("order:submit",(function(){var e=O.render({email:S.email,phone:S.phone});P.render(e)})),w.on("order:change",(function(e){var t=e.field,r=e.value;"payment"===t&&S.setPayment(r),"address"===t&&S.setAddress(r)})),w.on("contacts:change",(function(e){var t=e.field,r=e.value;"email"!==t&&"phone"!==t||S.setContactInfo("email"===t?r:S.email,"phone"===t?r:S.phone)})),w.on("order:success",(function(){S.isValid()?_.post("/order",Object.assign(Object.assign({},S.getOrderData()),{items:g.getItems().filter((function(e){return"number"==typeof e.price})).map((function(e){return e.id})),total:g.getTotalPrice()})).then((function(){var e=g.getTotalPrice(),t=E.render(e);P.open(t),g.clear(),V.renderCartCounter(0),S.clear()})).catch((function(e){return console.error("Ошибка отправки заказа:",e)})):(O.showError("email","Введите email"),O.showError("phone","Введите телефон"))}))})();
//# sourceMappingURL=main.js.map